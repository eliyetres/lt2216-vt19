<?xml version="1.0" encoding="UTF-8"?>
<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml" xmlns:voxeo="http://community.voxeo.com/xmlns/vxml">
    <nomatch>I didn't understand.<reprompt />
    </nomatch>
    <noinput>You didn't say anything.<reprompt />
    </noinput> <!-- Data model -->
    <var name="from" />
    <var name="to" />
    <var name="date" />
    <var name="returnTo" /> <!-- Menu -->
    <menu>
        <prompt>Welcome to the flight booking service. Would you like to book a flight or get information about delayed flights? Say one of: <enumerate />
        </prompt>
        <choice next="#welcome">Book</choice>
        <choice next="#delayedFlights">Delayed</choice>
    </menu> <!-- Delayed flights -->
    <form id="delayedFlights">
        <field name="delayedFlightsForm">
            <prompt>
                <noinput>All flights are on time.</noinput>
            </prompt>
        </field>
    </form>
    <!-- State machine -->
    <form id="welcome">
        <block>
            <prompt>
                <break time="2000" />Welcome to the flight booking service.</prompt>
            <goto next="#askFrom" />
        </block>
    </form> <!-- Leaving from -->
    <form id="askFrom">
        <field name="fromField">
            <prompt>What city are you leaving from? <noinput>The options are: London, Paris or New York.<reprompt />
                </noinput>
            </prompt>
            <option>London</option>
            <option>Paris</option>
            <option>New york</option>
        </field>
        <filled>
            <assign name="from" expr="fromField" />
            <goto next="#askTo" />
        </filled>
    </form>
    <!-- Going to  -->
    <form id="askTo">
        <field name="toField">
            <prompt>Where are you going? <noinput>The options are: London, Paris or New York.<reprompt />
                </noinput>
            </prompt>
            <option>London</option>
            <option>Paris</option>
            <option>New York</option>
        </field>
        <filled>
            <assign name="to" expr="toField" />
            <!-- Error if from and to dates are the same, start over  -->
            <if cond="from == to ">
                <prompt bargein="false">I'm sorry, you can't leave and return to the same city.</prompt>
                <goto next="#askTo" />
            </if>
            <goto next="#askDate" />
        </filled>
    </form>
    <!-- Select date -->
    <form id="askDate">
        <field name="toField">
            <prompt>Is it a one-way trip?</prompt>
            <option>Yes</option>
            <option>No</option>
        </field>
        <filled>
            <goto next="#wayTrip" />
        </filled>
    </form> <!-- If YES for one way trip -->
    <form id="askOneWay">
        <field name="oneWayField">
            <prompt>Do you want to go <value expr="from" /> to<value expr="to" /> on<value expr="date" />?<option>Yes</option>
                <option>No</option>
            </prompt>
        </field>
        <filled>
            <if cond="oneWayField == 'yes'">
                <goto next="#confirmFlight" />
            </if>
            <elseif cond="oneWayField == 'no'">
                <goto next="#askFrom" />
            </elseif>
        </filled>
    </form>
    <!-- If NO for one way trip -->
    <form id="wayTrip">
        <field name="returnOn">
            <prompt>What date do you want to return?</prompt>
            <option>Tomorrow</option>
            <option>Monday</option>
            <option>Tuesday</option>
            <option>Wednesday</option>
            <option>Thursday</option>
            <option>Friday</option>
            <option>Saturday</option>
            <option>Sunday</option>
            <nomatch>
        I didn't hear that. You can select tomorrow, or any weekday.
        <reprompt />
            </nomatch>
        </field>
        <filled>
            <assign name="date" expr="returnOn" />
            <goto next="#confirm" />
        </filled>
    </form>
    <!-- Booking complete -->
    <form id="confirm">
        <field name="confirmFlight">
            <prompt bargein="false">Your flight has been booked! You're travelling from <value expr="from" />to<value expr="to" />on<value expr="date" />.
            </prompt>
        </field>
    </form>
</vxml>